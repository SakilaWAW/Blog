# 梯子运用及原理

## ShadowSocks

### 简介

一种软件、基于**Socks5代理方式(加密)**、代码开源(Apache/GPL/MIT)、客户端+服务端方式

## GFW

### 时间轴

1998/9/22 "金盾工程"建设
2002/9/3  Google.com被封，使用**DNS劫持**
2002/9/12 Google.com封锁解除，网页快照被封锁、使用**TCP会话阻断**

### 主要技术手段

#### DNS污染/劫持

防火墙在骨干网出口的53端口进行IDS入侵检测，检测到黑名单域名等，会伪装成域名服务器想客户机发送虚假IP，由于DNS查询基于UDP，先到先解析，导致客户机被骗，订到假IP。

#### IP封锁

在路由器中的路由表跳转的过程进行限制，早期使用ACL(访问控制列表)来进行IP黑名单限制，现在使用更搞笑的路由扩散技术来进行特定IP封锁。在出口路由配置错误信息达到丢包效果。动态路由协议可以让路由器通过交换路由表信息来动态更新路由表，并通过寻址算法来决定最优化的路径。因此可以通过动态路由协议的路由重分发功能将错误的信息散播到整个网络，从而达到屏蔽目的。

#### IP/端口黑名单

该手段可以结合上边提到的IP封锁技术，将封锁精确到具体的端口，使该IP的具体端口接收不到请求，从而达到更细粒度的封锁。经常被封锁的端口如下：

1. SSH的TCP协议22端口
2. HTTP的80端口
3. PPTP类型VPN使用的TCP协议1723端口，L2TP类型VPN使用的UDP协议1701端口，IPSec类型VPN使用的UDP协议500端口和4500端口，OpenVPN默认使用的TCP协议和UDP协议的1194端口
4. TLS/SSL/HTTPS的TCP协议443端口
5. Squid Cache的TCP协议3128端口

#### 无状态TCP连接重置

TCP连接会有三次握手，此种攻击方式利用了该特点来进行攻击，gfw会对特定IP的所有数据包进行监控，会对特定黑名单动作进行监控（如TLS加密连接），当进行TCP连接时，会在TCP连接的第二部SYNC-ACK阶段，伪装成客户端和服务器同时向真实的客户端和服务器发送RESET重置，以很低的成本来达到切断双方连接的目的。与丢弃客户机的包相比，在丢包后客户机会不断的发起重试，这样会加重黑洞服务器的负担，利用TCP连接重置来断开连接，客户机也不必发送ACK来确认，这样成本就要低得多。

#### TCP协议关键字阻断

该手段在无状态TCP连接重置手段之上，加入了关键字过滤功能，当协议的头部包含特定的关键字便对其连接进行重置，比如HTTP协议、ED2K协议等等。

#### 深度包检测

深度数据包检测（Deep packet inspection,DPI）是一种于应用层对网络上传递的数据进行侦测与处理的技术，被广泛用于入侵检测、流量分析及数据挖掘。就字面意思考虑，所谓“深度”是相对于普通的报文检测而言的——相较普通的报文检测，DPI可对报文内容和协议特征进行检测。
基于必要的硬件设施、适宜的检测模型及相应的模式匹配算法，gfw能够精确且快速地从实时网络环境中判别出有悖于预期标准的可疑流量，并对此及时作出审查者所期望的应对措施。